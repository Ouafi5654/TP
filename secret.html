<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dino Chrome SimplifiÃ©</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #eee;
      font-family: sans-serif;
    }
    #game {
      position: relative;
      width: 800px;
      height: 250px;
      background: #fff;
      border: 2px solid #ccc;
      overflow: hidden;
    }
    .ground {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 20px;
      background: #ccc;
    }
    #player {
      position: absolute;
      left: 50px;
      bottom: 20px;
      width: 60px;
      height: 60px;
      background: url('player.png') center/contain no-repeat;
    }
    .obstacle {
      position: absolute;
      bottom: 20px;
      width: 50px;
      height: 50px;
      background: url('bacteria.png') center/contain no-repeat;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      font-weight: bold;
    }
    #gameover {
      position: absolute;
      inset: 0;
      display: none;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      font-weight: bold;
      background: rgba(255,255,255,0.7);
      color: red;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="score">Score: 0</div>
    <div id="player"></div>
    <div class="ground"></div>
    <div id="gameover">Game Over â€“ Espace pour rejouer</div>
  </div>
  <audio id="winSound" src="win.mp3" preload="auto"></audio>

  <script>
    const game = document.getElementById('game');
    const player = document.getElementById('player');
    const scoreEl = document.getElementById('score');
    const gameoverEl = document.getElementById('gameover');
    const winSound = document.getElementById('winSound');

    let score = 0;
    let nextMilestone = 10;
    let running = false;
    let vy = 0;
    let gravity = 1400;
    let jumpVel = 520;
    let py = 20;
    let onGround = true;
    let obstacles = [];
    let speed = 200;

    let lastTime = 0;
    let scoreTimer = null;
    let spawnTimer = null;

    function resetGame() {
      score = 0;
      nextMilestone = 10;
      scoreEl.textContent = "Score: 0";
      py = 20; vy = 0; onGround = true;
      player.style.bottom = py + "px";

      obstacles.forEach(o => o.el.remove());
      obstacles = [];

      gameoverEl.style.display = "none";
    }

    function startGame() {
      resetGame();
      running = true;
      lastTime = performance.now();
      requestAnimationFrame(loop);

      if (scoreTimer) clearInterval(scoreTimer);
      if (spawnTimer) clearInterval(spawnTimer);

      scoreTimer = setInterval(() => {
        if (running) {
          score++;
          scoreEl.textContent = "Score: " + score;

          if (score >= nextMilestone) {
            try { winSound.play(); } catch(e){}
            nextMilestone += 10;
          }
        }
      }, 1000);

      spawnTimer = setInterval(() => {
        if (running) spawnObstacle();
      }, 3000); // Moins dâ€™obstacles
    }

    function endGame() {
      running = false;
      gameoverEl.style.display = "flex";

      clearInterval(scoreTimer);
      clearInterval(spawnTimer);
    }

    function spawnObstacle() {
      const el = document.createElement('div');
      el.className = "obstacle";
      el.style.left = game.clientWidth + "px";
      game.appendChild(el);
      obstacles.push({ el, x: game.clientWidth });
    }

    function loop(now) {
      if (!running) return;

      const dt = (now - lastTime) / 1000;
      lastTime = now;

      vy -= gravity * dt;
      py += vy * dt;
      if (py <= 20) { py = 20; vy = 0; onGround = true; }
      player.style.bottom = py + "px";

      for (let i = obstacles.length - 1; i >= 0; i--) {
        const o = obstacles[i];
        o.x -= speed * dt;
        o.el.style.left = o.x + "px";

        if (o.x + 50 < 0) {
          o.el.remove();
          obstacles.splice(i, 1);
        }

        // ------------------------------
        // ðŸ“Œ HITBOX RÃ‰DUITE (plus permissive)
        // ------------------------------

        // Hitbox du joueur
        const px = 50 + 10; // DÃ©calage intÃ©rieur
        const pw = 40;      // Largeur petite
        const ph = 50;      // Hauteur petite

        // Hitbox de lâ€™obstacle
        const ox = o.x + 8;
        const ow = 35;
        const oh = 40;

        // Collision
        if (!(px + pw < ox || px > ox + ow || py + ph < 20 || py > 20 + oh)) {
          endGame();
          return;
        }
      }

      requestAnimationFrame(loop);
    }

    function jump() {
      if (!running) { startGame(); return; }
      if (onGround) { vy = jumpVel; onGround = false; }
    }

    document.addEventListener('keydown', e => {
      if (e.code === "Space" || e.code === "ArrowUp") {
        e.preventDefault();
        if (!running) startGame(); else jump();
      }
    });

    game.addEventListener('click', () => { 
      if (!running) startGame(); else jump(); 
    });
  </script>
</body>
</html>
